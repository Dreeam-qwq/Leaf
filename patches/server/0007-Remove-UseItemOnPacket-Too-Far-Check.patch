From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Dreeam <61569423+Dreeam-qwq@users.noreply.github.com>
Date: Fri, 18 Nov 2022 23:26:16 -0500
Subject: [PATCH] Remove UseItemOnPacket Too Far Check

This Check is added in 1.17.x -> 1.18.x update by Mojang.
By removing this check, it enable hackers to use some modules of hack clients.

diff --git a/src/main/java/net/minecraft/server/network/ServerGamePacketListenerImpl.java b/src/main/java/net/minecraft/server/network/ServerGamePacketListenerImpl.java
index 98ceec4404c08b08bc8d917730858eec40cfeb9e..985e7df56d893e642e71feb83250c1f0b9a649c2 100644
--- a/src/main/java/net/minecraft/server/network/ServerGamePacketListenerImpl.java
+++ b/src/main/java/net/minecraft/server/network/ServerGamePacketListenerImpl.java
@@ -186,6 +186,7 @@ import net.minecraft.world.phys.shapes.BooleanOp;
 import net.minecraft.world.phys.shapes.Shapes;
 import net.minecraft.world.phys.shapes.VoxelShape;
 import org.apache.commons.lang3.StringUtils;
+import org.dreeam.leaf.LeafConfig;
 import org.galemc.gale.concurrent.AsyncExecutor;
 import org.galemc.gale.concurrent.MinecraftServerBlockableEventLoop;
 import org.galemc.gale.configuration.GaleGlobalConfiguration;
@@ -1977,7 +1978,7 @@ public class ServerGamePacketListenerImpl implements ServerPlayerConnection, Tic
             Vec3 vec3d2 = vec3d.subtract(vec3d1);
             double d0 = 1.0000001D;
 
-            if (Math.abs(vec3d2.x()) < 1.0000001D && Math.abs(vec3d2.y()) < 1.0000001D && Math.abs(vec3d2.z()) < 1.0000001D) {
+            if ((Math.abs(vec3d2.x()) < 1.0000001D && Math.abs(vec3d2.y()) < 1.0000001D && Math.abs(vec3d2.z()) < 1.0000001D) || LeafConfig.removeUseItemOnPacketTooFar) { // Leaf - Remove UseItemOnPacket Too Far Check
                 Direction enumdirection = movingobjectpositionblock.getDirection();
 
                 this.player.resetLastActionTime();
diff --git a/src/main/java/org/dreeam/leaf/LeafConfig.java b/src/main/java/org/dreeam/leaf/LeafConfig.java
index 5838db890d3cb5b37533d22ee60730ac8f3e314a..5922be781760baedfb3a770c9e1ca40a73dfbc55 100644
--- a/src/main/java/org/dreeam/leaf/LeafConfig.java
+++ b/src/main/java/org/dreeam/leaf/LeafConfig.java
@@ -134,6 +134,7 @@ public class LeafConfig {
 
     public static boolean removeMojangUsernameCheck;
     public static boolean removeSpigotCheckBungeeConfig;
+    public static boolean removeUseItemOnPacketTooFar;
 
     private static void removeconfig() {
         removeMojangUsernameCheck = getBoolean("remove-Mojang-username-check", true,
@@ -142,5 +143,7 @@ public class LeafConfig {
         removeSpigotCheckBungeeConfig = getBoolean("remove-Spigot-check-bungee-config", true,
                 "Enable player enter backend server through proxy",
                 "without backend server enabling its bungee mode");
+        removeUseItemOnPacketTooFar = getBoolean("remove-UseItemOnPacket-too-far-check", false,
+        "To enable this, players can use some packet modules with hack clients");
     }
 }
